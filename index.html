<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Europe Explained</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./ScrollMagic.js"></script>
  </head>
  <body>
    
    <div class="scrollblock" id="examples-pin">
  		<h2>Welcome to Europe</h2>
      <!-- must put all the content on the sides here -->
      <!-- only things place above the pinned item will float over it -->
      <!-- in order to space this stuff here, must use css styling with px, cumulatively less than duration -->
  	</div>
    
    <!-- this makes the div stay in place dont delete -->
    <div class="scrollblock"> 

      <!-- <div id="my-sticky-element"> -->
      <div id="map"></div>
      <!-- </div> -->
  
      <p>hello</p>
      
      <p>next hello</p>
    
    </div>
  
    <p>hello europe</p>
    
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v3.min.js"></script>
    
    <style>
        
        svg {
          border-style: solid;
          border-width: 1px;
          border-color: #ccc;
        }
        
        .boundary {
          fill: #ddd;
          stroke: #888;
          stroke-linejoin: round;
        }
        
        .scrollblock {
          height: 200px;
          width: 100%;
        }
        #unpin {
          height: 800px;
          width: 100%;
        }
    </style>
    <script>
    
    
    
    
    // $(document).ready(function() {
    //     let scrollorama = $.scrollorama({
    //         blocks:'.scrollblock'
    //     });
    // 
    //     // scrollorama.animate('#map',{
    //     //   duration:400, property:'opacity'
    //     // })
    // 
    //     scrollorama.onBlockChange(function() {
    //         console.log('You just scrolled to block#'+scrollorama.blockIndex);
    //     });
    // 
    //     scrollorama.animate('#map',{ duration:500, property:'padding-top', start:400, pin:false })
    // 
    //     scrollorama.animate('#unpin',{ duration:5000, property:'padding-top', start:400, pin:true })
    // 
    // });
    
    // init controller
        var controller = new ScrollMagic.Controller();

        // create a scene
        new ScrollMagic.Scene({
        		duration: 3000,	// the scne should last for a scroll distance of 100px
        		offset: 150		// start this scene after scrolling for 50px
        	})
        	.setPin("#map") // pins the element for the the scene's duration
        	.addTo(controller); // assign the scene to the controller
            
    
      const height = 600;
      const width = 900;
      // geoOrthographic
      // var projection = d3.geoMercator()
      //               .center([ 15, 60 ]) 
			// 					   .translate([ width/2, height/2 ]) 
			// 					   .scale([ width/2.3 ]); 
      
      const projection = d3.geoOrthographic()
                        .center([ 10, 30 ]) 
     					          .translate([ width/2, height/2 ]) 
     					          .scale([ width * 1.1 ])
                        .rotate([-10, -20, -10 ]); 
      
      
      let europe = void 0;
      
      const path = d3.geoPath().projection(projection);
      
      const svg = d3.select('#map')
                    .append('svg')
                    .attr('height', height)
                    .attr('width', width)
      
      
      const membership = {};
    
      d3.csv("EuropeanStates.csv", function(data) {
        
        for (var i = 0; i < data.length; i++) {
          membership[data[i].State] = data[i]
        }
          console.log(membership);
      });
      
      const handleHover = (d) => {
        //console.log(d.properties.admin);
      }
      
    
      d3.json("region_un_Europe_subunits.json", function(error, data) {
         
         const countries = data.features
         
         //countries[61] = {properties: {admin: 'Russia'}};
         
         const map = svg.append('g').attr('class', 'boundary');
         
         europe = map.selectAll('path').data(countries) //must always be features regardless of what it says in json
        
        // const color = d3.scaleLinear().domain([0,71]).range(['orange', 'blue']);
        // 
        
        // const body = ['â‚¬', 'EU']
        // 
        // let filter = 
        // 
        
        let organization = 'EU'
        let membershipStatus = 'EU'
        
        const colorify = (data, org, status) => {

          let stateName = data.properties.admin
          if (!membership[stateName]) {return}
    
          return (membership[stateName][organization] === membershipStatus) ? 'blue' : 'red'
        
        }
        
        europe.enter()
          .append('path')
          .attr('d', path)
          .attr('fill', (d) => colorify(d, organization, membershipStatus))
          .on('mouseover', handleHover)
          
          
        
        europe.exit().remove();
        
         
      })

      
    </script>
  </body>
</html>