<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./ScrollMagic.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>

    <script src="./ScrollToPlugin.min.js"></script>

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <script src="./animation.gsap"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.scrollto@2.1.2/jquery.scrollTo.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/plugins/CSSPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/easing/EasePack.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenLite.min.js"></script>

    <script src="./noframework.waypoints.min.js"></script>

    <script src='./d3/d3.min.js'></script>
    <script src='./topojson/topojson.min.js'></script>

  </head>
  <body>

    <style>

    /* http://meyerweb.com/eric/tools/css/reset/
   v2.0 | 20110126
   License: none (public domain)
*/

      html, body, div, span, applet, object, iframe,
      h1, h2, h3, h4, h5, h6, p, blockquote, pre,
      a, abbr, acronym, address, big, cite, code,
      del, dfn, em, img, ins, kbd, q, s, samp,
      small, strike, strong, sub, sup, tt, var,
      b, u, i, center,
      dl, dt, dd, ol, ul, li,
      fieldset, form, label, legend,
      table, caption, tbody, tfoot, thead, tr, th, td,
      article, aside, canvas, details, embed,
      figure, figcaption, footer, header, hgroup,
      menu, nav, output, ruby, section, summary,
      time, mark, audio, video {
      	margin: 0;
      	padding: 0;
      	border: 0;
      	font-size: 100%;
      	font: inherit;
      	vertical-align: baseline;
      }
      /* HTML5 display-role reset for older browsers */
      article, aside, details, figcaption, figure,
      footer, header, hgroup, menu, nav, section {
      	display: block;
      }
      body {
      	line-height: 1;
      }
      ol, ul {
      	list-style: none;
      }
      blockquote, q {
      	quotes: none;
      }
      blockquote:before, blockquote:after,
      q:before, q:after {
      	content: '';
      	content: none;
      }
      table {
      	border-collapse: collapse;
      	border-spacing: 0;
      }



      #intro {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 92vh;
        width: 100%;
        background-color: #1E4675;
      }

      #intro-title {
        display: flex;
        flex-direction: column;
        align-items: left;
        justify-content: center;
        height: 50%;
        width: 100%
      }

      #title {
        font-size: 4em;
        color: white;
        font-family: Helvetica;
        width: 100%;
      }

      #description {
        margin-top: 1em;
        padding-bottom: 1em;
        font-size: 1.5em;
        color: white;
        font-family: Helvetica;
        font-style: italic;
        border-bottom: solid white;
        width: 85%;
      }

      #resume {
        width: 85%;
        margin-top: 1.2em;
        display: flex;
        flex-direction: row;
        justify-content: space-between;

      }
      #author {
        font-size: 1em;
        color: white;
        font-family: Helvetica;
        width: 50%;
      }

      #link-container {
        font-size: 1em;
        color: white;
        font-family: Helvetica;
        display: flex;
        flex-direction: row;
        justify-content: flex-end;
        width: 50%;
      }

      #link-container a {
        color: white;
        margin-left: 1.5em;
      }

      #link-container span {
        font-size: 1.1em;
      }



      #start-button {
        width: 15vw;
        height: 8vh;
        background-color: white;
        background-color: #F55526;
        padding: 0;
        border: none;
        outline: none;
        font-size: 1em;
        color: white;
        cursor: pointer;
        margin-top: 3em;
        margin-right: 2em;
      }


      #tag-line {
        font-family: Helvetica;
        font-size: 2em;
        color: white;
        align-self: center;
        font-style: italic;
      }

      .box2 {
        height: 400px;
        width: 100%;
      }
      /* THIS MAKES THE SPACING JITTERY BETWEEN first and second */
      /* .scrollmagic-pin-spacer {
        padding: 0px !important;
      } */

      .pin-container {
        display: flex;
        flex-direction: row;
      }

      #infoModal {
        display: flex;
        justify-content: center;
        align-items: center;
         position: absolute;
         z-index: 1;
         background: white;
         width: 14em;
         height:6em;
         color: white;
         font-size: 1em;
         top:-150px;
         left:-150px;
         border-radius: 5px;
         border: solid white;
         border-width: 1px;
         background-color: #214773;
         font-family: Helvetica;
         opacity: .8;
         /* padding: .5em; */
      }


      #header {
        display: flex;
        flex-direction: row;
        background-color: black;
        top:0;
        height: 8vh;
        width: 100%;

        /* transition:all 0.5s; */
        /* position: relative; */
        z-index: 1;
      }
/*
      body.header-fixed nav {
        position: fixed;
        box-shadow:0 5px 0 rgba(0,0,0,0.1);
      } */
      #logo {
        height: 100%;
        width: 15%;
        background-color: #F55526;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #logo p {
        color: white;
        font-family: Helvetica;
        font-style: italic;
        border: none;
        outline: none;
        font-size: 1.4em;
        font-weight: bold;
      }

      #nav {
        height: 100%;
        width: 85%;
        display: flex;
        flex-direction: row;
        /* justify-content: space-around; */
        align-items: center;
      }

      .link {
        width: 30%;
        height: 100%;
        background-color: white;
        border: none;
        outline: none;
        font-size: 1em;
        cursor: pointer;
        font-weight: bold;
      }
      .highlight-link {
        background-color: orange;
        color: white;
      }

      .stop-scrolling {
        height: 100%;
        overflow: hidden;
      }

      #map{
        width: 65%;
        height: 92vh;
      }
      #pin2 {
        width: 35%;
        /* height: 5000px; */

      }

      /* .big-space {
        height: 92vh;
        width: 100%;
        background-color: #1E4675;
      } */

      .section {
        display: flex;
        align-items: center;
        justify-content: left;
        flex-direction: column;
        background-color: #1E4675;
        height: 100vh;
      }
      .thirtysecond {
        display: flex;
        align-items: center;
        justify-content: left;
        flex-direction: column;
        background-color: #1E4675;
        height: 100vh;
      }

      .section-title {
        height: 50%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: left;
      }
      .title-text {
        font-size: 4em;
        color: white;
        font-family: Helvetica;
        padding-top: 2em;
      }

      .section-explanation {
        height: 50%;
        width: 100%;
        padding-top: 2em;
        display: flex;
        align-items: center;
        justify-content: left;
      }

      .explanation-text {
        height: 100%;
        width: 100%;
        margin-right: 4em;
        padding-top: 2em;
        margin-top: 2em;
        color: white;
        font-size: .9em;
        font-family: Helvetica;
        line-height: 1.4;
        border-top: solid;
        font-style: italic;
      }


      #buffer {
        height: 50vh;
      }


      /* disable scroll bar but only for chrome */
      ::-webkit-scrollbar {
          display: none;
      }


    </style>

    <div id="main-container">
				<section id="titlechart">
          <nav id="header">
            <div id="logo">
              <p>Das Map!</p>
            </div>
            <div id="nav">
              <button id="welcome-link" data-position='intro' class="link highlight-link">Welcome</button>
              <button id="eu-link" data-position='enter-section-2' class="link">EU</button>
              <button id="eurozone-link" data-position='enter-section-12' class="link">Eurozone</button>
              <button id="eurocrisis-link" data-position='enter-section-16' class="link">Euro Crisis</button>
              <button id="Schengen-link" data-position='enter-section-20' class="link">Schengen</button>
              <button id="migration-link" data-position='enter-section-25' class="link">Migration</button>
              <button id="nato-link" data-position='enter-section-28' class="link">NATO</button>
              <!-- <button id="about-link" data-position='outro' class="link">About</button> -->
            </div>
          </nav>
          <div id="infoModal"></div>
          <div id="trigger-header"></div>

					<script>
						// init controller
						var controller = new ScrollMagic.Controller();

					</script>

				</section>
				<section class="demo">
					<div class="spacer s2"></div>
          <!-- <div class="big-space">

          </div> -->
          <div class="trigger-container">

            <div id="trigger-map"></div>
            <div id="trigger-explanation"></div>
            <div id="trigger-first-section"></div>
          </div>

          <div class="pin-container">
  					<div id="map"></div>

            <script>
            const height = document.documentElement.clientHeight
            const width = document.documentElement.clientWidth

            const projection = d3.geoOrthographic()
                              .center([ 16, 30 ])
                              .translate([ width/2, height/2 ])
                              .scale([ width/1.07 ])
                              .rotate([-10, -20, 0 ]);


            let europe = void 0;

            const path = d3.geoPath().projection(projection);

            const svg = d3.select('#map')
                          .append('svg')
                          .attr('height', height)
                          .attr('width', width)

                  //this creates the background
                  // by appending it before the 'g' map is rendered, it places it in the background
                  svg.append("rect")
                        .attr("width", "100%")
                        .attr("height", "100%")
                        .attr("fill", "#1E4675");
            </script>

  					<div id="pin2">
              <div id="intro">
                <div id="intro-title">
                  <p id="title">European <br>Integration</p>
                  <p id="description">A Geographic History</p>
                  <div id="resume">
                    <div id="author">
                      <p>by Kenta Kodama</p>
                    </div>
                    <div id="link-container">
                      <a href="https://github.com/kentakodama" target="_blank"><span class="fa fa-github"></span></a>
                      <a href="https://www.linkedin.com/in/kentakodama/" target="_blank"><span class="fa fa-linkedin-square"></span></a>
                    </div>
                  </div>
                </div>
                <button id="start-button" data-position='enter-section-1' class="link">
                  EXPLORE
                </button>
              </div>
              <div id="enter-section-1"></div>
              <div class="first section">
                <div class="section-title">
                  <p class="title-text"> Modern<br>Europe</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text" class="explanation-text">The nations of Europe constitute the most integrated area in the world. Several unique institutions bind these once disparate, and historically warring, nations together.</p>
                </div>
              </div>
              <div id="reverse-enter-section-1"></div>
              <div id="enter-section-2"></div>
              <div id="pin3" class="second section">
                <div class="section-title">
                  <p class="title-text">The <br> European <br> Union</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">The vast majority of nations in Europe are member states of the European Union. The EU's most successful effort at integration has been economic. At its most fundamental level, the EU is a customs union that has not only abolished internal tariffs, but also created a common labor market. Citizens of one member state can work, live, and even vote freely in any country.</p>
                </div>
              </div>
              <div id="reverse-enter-section-2"></div>
              <div id="enter-section-3"></div>
              <div id='pin4' class="third section">
                <div class="section-title">
                  <p class="title-text">EU <br> Hopefuls</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">These nations are on their way to signing accession, or membership, treaties with the European Union. Their likelihood of success depends on a decade-long process to bring their political, social, legal, economic, and regulatory standards up to those prescribed by the EU.</p>
                </div>
              </div>
              <div id="reverse-enter-section-3"></div>
              <div id="enter-section-4"></div>
              <div id='pin5' class="fourth section">
                <div class="section-title">
                  <p class="title-text">The <br> Misfits</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">These countries have the political and economic standards for near-automatic EU-accession. Their citizens, however, have been reluctant to join for various reasons.</p>
                </div>
              </div>
              <div id="reverse-enter-section-4"></div>
              <div id="enter-section-5"></div>
              <div id='pin6' class="fifth section">
                <div class="section-title">
                  <p class="title-text">EU <br> Growth</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">The EU is big. Its population is over half a billion and its economy is the largest in the world. However, it wasn't always like this ...</p>
                </div>
              </div>
              <div id="reverse-enter-section-5"></div>
              <div id="enter-section-6"></div>
              <div id='pin7' class="sixth section">
                <div class="section-title">
                  <p class="title-text">The <br> Inner Six</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">The European Economic Community, the predecessor organization to the EU, was formed with the Treaty of Rome in 1957 with only six members.</p>
                </div>
              </div>
              <div id="reverse-enter-section-6"></div>
              <div id="enter-section-7"></div>
              <div id='pin8' class="seventh section">
                <div class="section-title">
                  <p class="title-text">The <br> Original 12</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Six other nations joined and, by 1992, formed the European Union with the Maastricht Treaty. It created a framework for further integration and expansion in anticipation for the newly independent eastern-bloc countries eventually joining.</p>
                </div>
              </div>
              <div id="reverse-enter-section-7"></div>
              <div id="enter-section-8"></div>
              <div id='pin9' class="eighth section">
                <div class="section-title">
                  <p class="title-text">The <br> Western 15</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">By 1995, several other developed economies joined the union.</p>
                </div>
              </div>
              <div id="reverse-enter-section-8"></div>
              <div id="enter-section-9"></div>
              <div id='pin10' class="ninth section">
                <div class="section-title">
                  <p class="title-text">Eastern <br> Expansion</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">2004 saw the largest geographic and population expansion by far. The EU welcomed eight former Soviet and Soviet-allied countries. Bringing formerly undemocratic, Communist nations into the union was seen as a great achievement at the time.</p>
                </div>
              </div>
              <div id="reverse-enter-section-9"></div>
              <div id="enter-section-10"></div>
              <div id='pin11' class="tenth section">
                <div class="section-title">
                  <p class="title-text">Now</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Currently, the European Union boasts 28 members with Croatia joining most recently in 2013.</p>
                </div>
              </div>
              <div id="reverse-enter-section-10"></div>
              <div id="enter-section-11"></div>
              <div id='pin12' class="eleventh section">
                <div class="section-title">
                  <p class="title-text"> <br> Brexit</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">...but for some reason, the United Kingdom voted to leave the Union in 2016. It was the first time that the union shrank because a sovereign nation quit the club.</p>
                </div>
              </div>
              <div id="reverse-enter-section-11"></div>
              <div id="enter-section-12"></div>
              <div id='pin13' class="twelfth section">
                <div class="section-title">
                  <p class="title-text"> <br> The Euro</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Perhaps most synonomous with European integration is its single currency. EU member states voluntarily gave up their respective currencies such as the French Franc, Italian Lira, and German Mark in favor of the Euro. It's currently the second most traded currency in the world after the US Dollar.</p>
                </div>
              </div>
              <div id="reverse-enter-section-12"></div>
              <div id="enter-section-13"></div>
              <div id='pin14' class="thirteen section">
                <div class="section-title">
                  <p class="title-text">The <br> Eurozone</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">... but only these EU nations officially use the Euro. Collectively they constitute what is known as the Eurozone.</p>
                </div>
              </div>
              <div id="reverse-enter-section-13"></div>
              <div id="enter-section-14"></div>
              <div id='pin15' class="fourteenth section">
                <div class="section-title">
                  <p class="title-text">Future <br> Eurozone</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">These nations are obligated under accession treaties to eventually forego their national currencies and join the single currency.</p>
                </div>
              </div>
              <div id="reverse-enter-section-14"></div>
              <div id="enter-section-15"></div>
              <div id='pin16' class="fifteenth section">
                <div class="section-title">
                  <p class="title-text">Currency <br> Opt-outs</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Depending on who you ask, these nations got a break. The United Kingdom and Denmark are exempt from participating in the single currency - a concession they garnered as founding members of the EU.</p>
                </div>
              </div>
              <div id="reverse-enter-section-15"></div>
              <div id="enter-section-16"></div>
              <div id='pin17' class="sixteen section">
                <div class="section-title">
                  <p class="title-text">Benefits <br>& Risks </p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">The single currency proved beneficial in many respects. Reduced financial costs facilitated increased trade amongst members. Greater investment confidence in the supposed stability of the Euro reduced borrowing costs especially for smaller economies. But there have also been drawbacks, particularly with nations' ability to service their debt ...</p>
                </div>
              </div>
              <div id="reverse-enter-section-16"></div>
              <div id="enter-section-17"></div>
              <div id='pin18' class="seventeenth section">
                <div class="section-title">
                  <p class="title-text">National <br> Debt 2008</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">All nations in the EU entered the financial crisis of late 2008 with what appeared to be manageable levels of debt.</p>
                </div>
              </div>
              <div id="reverse-enter-section-17"></div>
              <div id="enter-section-18"></div>
              <div id='pin19' class="eigteenth section">
                <div class="section-title">
                  <p class="title-text">National <br> Debt 2016</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">... in 2016 - well after economies should have been growing - European nations, in particular the Eurozone, experienced growing debt to GDP burdens.</p>
                </div>
              </div>
              <div id="reverse-enter-section-18"></div>
              <div id="enter-section-19"></div>
              <div id='pin20' class="ninteenth section">
                <div class="section-title">
                  <p class="title-text">The Euro <br> Handcuffs </p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Participating in the single currency meant relinquishing control over monetary policy to the European Central Bank. A nation with monetary sovereignty can control the supply of its currency, allowing it to influence exchange rates in response to trade or fiscal conditions. For example, the United Kingdom might devalue its currency, the Pound, to lower the cost of exports and lessen its debt burden. Eurozone debt, as seen here, has outpaced that of EU members not participating in the Euro. Countries in red experienced faster debt growth than nations in yellow.</p>
                </div>
              </div>
              <div id="reverse-enter-section-19"></div>
              <div id="enter-section-20"></div>
              <div id='pin21' class="twentieth section">
                <div class="section-title">
                  <p class="title-text">The <br> Schengen <br> Area</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">To complement the EU's abolition of trade barriers, there are no internal border controls (under normal circumstances) between member states. Participating countries have effectively outsourced their immigration to EU authorities. With almost all EU nations participating in the program, the free movement of people is a cherished pillar of continental integration.</p>
                </div>
              </div>
              <div id="reverse-enter-section-20"></div>
              <div id="enter-section-21"></div>
              <div id='pin22' class="twentyfirst section">
                <div class="section-title">
                  <p class="title-text">Schengen <br> Holdouts</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Once again, the United Kingdom stands out as an exception. Ireland, which once had a contentious relationship with the UK's Northern Ireland, followed suit. These two nations instead formed the Common Travel Area, a separate agreement to prevent a divided Ireland and to facilitate peace.</p>
                </div>
              </div>
              <div id="reverse-enter-section-21"></div>
              <div id="enter-section-22"></div>
              <div id='pin23' class="twentysecond section">
                <div class="section-title">
                  <p class="title-text">Schengen's <br> Popularity</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Even non-EU states see the benefits of open borders for travel. These countries participate in Schengen while shying away from full EU-member status.</p>
                </div>
              </div>
              <div id="reverse-enter-section-22"></div>
              <div id="enter-section-23"></div>
              <div id='pin24' class="twentythird section">
                <div class="section-title">
                  <p class="title-text">Schengen Expansion</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Eventual expansion of the free movement area to all members is guaranteed by the EU, but more recent members are regularly put on a delayed timeline. This is done to appease governments of richer member states who fear increased immigration levels from newly admitted states.</p>
                </div>
              </div>
              <div id="reverse-enter-section-23"></div>
              <div id="enter-section-24"></div>
              <div id='pin25' class="twentyfourth section">
                <div class="section-title">
                  <p class="title-text">Schengen Results</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">While the agreement facilitated invaluable cultural exchange among citizens of participating countries, it has also led to greater difficulty addressing immigration from outside the EU. Similar to how nations lost a degree of independence to the Euro, states delegated border controls to the EU, therefore making one nation's problem a club-wide challenge.</p>
                </div>
              </div>
              <div id="reverse-enter-section-24"></div>
              <div id="enter-section-25"></div>
              <div id='pin26' class="twentyfifth section">
                <div class="section-title">
                  <p class="title-text">Migrant <br> Crisis </p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">In 2015, several factors contributed to an unprecedented influx of migrants. Macedonia eased onward journeys to the EU. This provided a cheaper, safer route than crossing the Mediterranean, which had been popular up until that point. At the same time, Syria's government eased emmigration to rid itself of political opponents in its civil war. Southern European nations, especially Greece and Bulgaria, received the the vast majority of new arrivals into the Schengen Area.</p>
                </div>
              </div>
              <div id="reverse-enter-section-25"></div>
              <div id="enter-section-26"></div>
              <div id='pin27' class="twentysixth section">
                <div class="section-title">
                  <p class="title-text">Asylum <br>Applicants</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">... free travel within the Schengen Area, however, allowed migrants to move several countries beyond their entry point. Applications for ayslum visas skyrocketed in many countries, most notably in Hungary and Germany.</p>
                </div>
              </div>
              <div id="reverse-enter-section-26"></div>
              <div id="enter-section-27"></div>
              <div id='pin28' class="twentyseventh section">
                <div class="section-title">
                  <p class="title-text">...by <br>Population </p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Some nations were more overwhelmed than others, especially considering the number of applications received relative to population size.</p>
                </div>
              </div>
              <div id="reverse-enter-section-27"></div>
              <div id="enter-section-28"></div>
              <div id='pin29' class="twentyeighth section">
                <div class="section-title">
                  <p class="title-text"> <br> NATO</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Joint security under the North Atlantic Treaty Organization represents the final pillar of European integration. Its success is perhaps the most remarkable of integration efforts owing to the fact that, since its inception, there has never been a war between the historically belligerent great powers of Europe.</p>
                </div>
              </div>
              <div id="reverse-enter-section-28"></div>
              <div id="enter-section-29"></div>
              <div id='pin30' class="twentyninth section">
                <div class="section-title">
                  <p class="title-text">NATO's <br> Origins</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">In 1949, several European nations along with the United States and Canada became founding NATO members. Necessitated by the Cold War between the West and the Soviet Union and buttressed by American military commitment, NATO's core mission is to provide mutual security. If one nation is attacked, the treaty binds all signatories to come to its defense.</p>
                </div>
              </div>
              <div id="reverse-enter-section-29"></div>
              <div id="enter-section-30"></div>
              <div id='pin31' class="thirtieth section">
                <div class="section-title">
                  <p class="title-text">NATO <br> Expansion</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">By the end of the Cold War in 1991, NATO had expanded to include most of western Europe.</p>
                </div>
              </div>
              <div id="reverse-enter-section-30"></div>
              <div id="enter-section-31"></div>
              <div id='pin32' class="thirtyfirst section">
                <div class="section-title">
                  <p class="title-text">Eastern <br> Expansion</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">The collapse of the Soviet Union and its client states in Eastern Europe left the future of the alliance in doubt. Although initially hesitant, the North Atlantic Treaty Organization accepted formerly communist nations in eastern Europe, drawing protest from Russia, the area's historic great power. The prospect of more ex-Soviet countries joining the security alliance grew ...</p>
                </div>
              </div>
              <div id="reverse-enter-section-31"></div>
              <div id="enter-section-32"></div>
              <div id='pin33' class="thirtysecond">
                <div class="section-title">
                  <p class="title-text">The <br> Ukraine <br> Conflict</p>
                </div>
                <div class="section-explanation">
                  <p class="explanation-text">Although precipitated by the progress of an EU-Ukraine association agreement, the prospect of Ukraine being absorbed into the European Union or even NATO proved untenable for Russia. Russia annexed the Crimean Peninsula and invaded eastern Ukraine with the help of local separatists in 2014.</p>
                </div>
              </div>
              <div id="reverse-enter-section-32"></div>
              <div id="buffer" class="section">

              </div>
  					</div>


          </div>
            <!-- <div id="outro">
              <img id="photo" src="https://res.cloudinary.com/dql6mlrow/image/upload/q_66/v1518084261/DSCF5974_yrqu9o.jpg"/>
                <div id="outro-content">
                  <div id="bio-container">
                    <p>Kenta Kodama is a software developer and cartographer currently located in the San Francisco Bay Area. If you would like to hire him to make your data map please feel free to contact him at any of the links below.</p>
                  </div>
                  <div id="resume-container">

                  </div>
                </div>
            </div> -->
					<div class="spacer s2"></div>
					<script>
            //   require('./animation.gsap');
            //   var gsap = require("gsap");



						$(function () { // wait for document ready
							// build scene


              // build tween
            	var tween = TweenMax.from("#animate", 0.5, {autoAlpha: 0, scale: 0.7});

            	// var sceneNav = new ScrollMagic.Scene({triggerElement: "#pin3", duration: 200, triggerHook: "onLeave"})
            	// 				.setTween(tween)
            	// 				// .addIndicators() // add indicators (requires plugin)
            	// 				.addTo(controller);



            	controller.scrollTo(function (newpos) {
                let constant = .12
                let distance = Math.abs(newpos - window.pageYOffset)
                if(distance < window.innerHeight) {
                  constant = .8
                }
                let slides = distance/window.innerHeight
                let speed = slides * constant
            		TweenMax.to(window, speed, {scrollTo: {y: newpos}});
            	});


            	//  bind scroll to anchor links
              const buttons = document.querySelectorAll('.link')
              for (var i = 0; i < buttons.length; i++) {
                buttons[i].addEventListener("click", function (e) {

              		var pos = $(this).attr("data-position");

              		if ($(pos).length > 0) {
              			e.preventDefault();
                  }
              			// trigger scroll
              			controller.scrollTo(`#${pos}`)
                }
              	)
              }




              // var intro = $('#intro');
              // var range = 200;
              //
              // $(window).on('scroll', function () {
              //
              //   var scrollTop = $(this).scrollTop(),
              //       height = intro.outerHeight(),
              //       offset = height/1.2,
              //       calc = 1 - (scrollTop - offset + range) / range;
              //
              //   console.log(scrollTop);
              //
              //   intro.css({ 'opacity': calc });
              //
              //   if (calc > '1') {
              //     intro.css({ 'opacity': 1 });
              //   } else if ( calc < '0' ) {
              //     intro.css({ 'opacity': 0 });
              //   }
              //
              // });

              // const nav = document.querySelector('#intro');
              // let topOfNav = nav.offsetTop;
              //
              // function fixNav() {
              //   if(window.scrollY >= topOfNav) {
              //     document.body.style.paddingTop = nav.offsetHeight + 'px';
              //     document.body.classList.add('header-fixed');
              //   } else {
              //     document.body.classList.remove('header-fixed');
              //     document.body.style.paddingTop = 0;
              //   }
              // }
              //
              // window.addEventListener('scroll', fixNav);
              //


							var headerScene = new ScrollMagic.Scene({triggerElement: "#header",triggerHook: 0})
											.setPin("#header")
											// .addIndicators({name: "1 (duration: 700)"}) // add indicators (requires plugin)
											.addTo(controller);

							var scene1 = new ScrollMagic.Scene({triggerElement: "#header",triggerHook: 0})
											.setPin("#map")
                      // .offset(-100)
											// .addIndicators({name: "1 (duration: 700)"}) // add indicators (requires plugin)
											.addTo(controller);

							var scene2 = new ScrollMagic.Scene({triggerElement: "#map",triggerHook: 0, duration: 1})
											.setPin("#pin2")
                      // .offset(-100)
											// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
											.addTo(controller);

							// var scene3 = new ScrollMagic.Scene({triggerElement: "#enter-section-2",triggerHook: 0, duration: 700})
							// 				.setPin("#pin3")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
              //
							// var scene4 = new ScrollMagic.Scene({triggerElement: "#enter-section-3",triggerHook: 0, duration: 700})
							// 				.setPin("#pin4")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene5 = new ScrollMagic.Scene({triggerElement: "#enter-section-4",triggerHook: 0, duration: 700})
							// 				.setPin("#pin5")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene6 = new ScrollMagic.Scene({triggerElement: "#enter-section-5",triggerHook: 0, duration: 700})
							// 				.setPin("#pin6")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene7 = new ScrollMagic.Scene({triggerElement: "#enter-section-6",triggerHook: 0, duration: 700})
							// 				.setPin("#pin7")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene8 = new ScrollMagic.Scene({triggerElement: "#enter-section-7",triggerHook: 0, duration: 700})
							// 				.setPin("#pin8")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene9 = new ScrollMagic.Scene({triggerElement: "#enter-section-8",triggerHook: 0, duration: 700})
							// 				.setPin("#pin9")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene10 = new ScrollMagic.Scene({triggerElement: "#enter-section-9",triggerHook: 0, duration: 700})
							// 				.setPin("#pin10")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene11 = new ScrollMagic.Scene({triggerElement: "#enter-section-10",triggerHook: 0, duration: 700})
							// 				.setPin("#pin11")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene12 = new ScrollMagic.Scene({triggerElement: "#enter-section-11",triggerHook: 0, duration: 700})
							// 				.setPin("#pin12")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene13 = new ScrollMagic.Scene({triggerElement: "#enter-section-12",triggerHook: 0, duration: 700})
							// 				.setPin("#pin13")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene14 = new ScrollMagic.Scene({triggerElement: "#enter-section-13",triggerHook: 0, duration: 700})
							// 				.setPin("#pin14")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene15 = new ScrollMagic.Scene({triggerElement: "#enter-section-14",triggerHook: 0, duration: 700})
							// 				.setPin("#pin15")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene16 = new ScrollMagic.Scene({triggerElement: "#enter-section-15",triggerHook: 0, duration: 700})
							// 				.setPin("#pin16")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene17 = new ScrollMagic.Scene({triggerElement: "#enter-section-16",triggerHook: 0, duration: 700})
							// 				.setPin("#pin17")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene18 = new ScrollMagic.Scene({triggerElement: "#enter-section-17",triggerHook: 0, duration: 700})
							// 				.setPin("#pin18")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene19 = new ScrollMagic.Scene({triggerElement: "#enter-section-18",triggerHook: 0, duration: 700})
							// 				.setPin("#pin19")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene20 = new ScrollMagic.Scene({triggerElement: "#enter-section-19",triggerHook: 0, duration: 700})
							// 				.setPin("#pin20")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene21 = new ScrollMagic.Scene({triggerElement: "#enter-section-20",triggerHook: 0, duration: 700})
							// 				.setPin("#pin21")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene22 = new ScrollMagic.Scene({triggerElement: "#enter-section-21",triggerHook: 0, duration: 700})
							// 				.setPin("#pin22")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene23 = new ScrollMagic.Scene({triggerElement: "#enter-section-22",triggerHook: 0, duration: 700})
							// 				.setPin("#pin23")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene24 = new ScrollMagic.Scene({triggerElement: "#enter-section-23",triggerHook: 0, duration: 700})
							// 				.setPin("#pin24")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene25 = new ScrollMagic.Scene({triggerElement: "#enter-section-24",triggerHook: 0, duration: 700})
							// 				.setPin("#pin25")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene26 = new ScrollMagic.Scene({triggerElement: "#enter-section-25",triggerHook: 0, duration: 700})
							// 				.setPin("#pin26")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene27 = new ScrollMagic.Scene({triggerElement: "#enter-section-26",triggerHook: 0, duration: 700})
							// 				.setPin("#pin27")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene28 = new ScrollMagic.Scene({triggerElement: "#enter-section-27",triggerHook: 0, duration: 700})
							// 				.setPin("#pin28")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene29 = new ScrollMagic.Scene({triggerElement: "#enter-section-28",triggerHook: 0, duration: 700})
							// 				.setPin("#pin29")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene30 = new ScrollMagic.Scene({triggerElement: "#enter-section-29",triggerHook: 0, duration: 700})
							// 				.setPin("#pin30")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene31 = new ScrollMagic.Scene({triggerElement: "#enter-section-30",triggerHook: 0, duration: 700})
							// 				.setPin("#pin31")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							// var scene32 = new ScrollMagic.Scene({triggerElement: "#enter-section-31",triggerHook: 0, duration: 700})
							// 				.setPin("#pin32")
							// 				// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
							// 				.addTo(controller);
							var scene33 = new ScrollMagic.Scene({triggerElement: "#enter-section-32",triggerHook: 0})
											.setPin("#pin33")
											// .offset(-100)// .addIndicators({name: "2 (duration: 500)"}) // add indicators (requires plugin)
											.addTo(controller);


						});
					</script>
				</section>


			</div>
      <script>

      // // const hideIntro = () => {
      //   window.addEventListener('scroll', ()=> {
      //     let intro = document.getElementById('intro');
      //     if (intro.getBoundingClientRect().bottom < 0) { return }
      //     containerInfo = intro.getBoundingClientRect();
      //     if (containerInfo.top < 0) {
      //       console.log(containerInfo.bottom);
      //       intro.style.height = `${containerInfo.bottom}px`;
      //     }
      // })

        //intro.style.height = 0;

      // }


      // window.addEventListener('scroll', () => {
      //   let intro = document.getElementById('intro')
      //   if (intro.clientHeight > 0) {
      //     intro.classList.add('stop-scrolling')
      //   }
      //
      // })



      const switchLinkHighlight = (linkId, turnOn) => {

        let link = document.getElementById(linkId)

        if (turnOn) {
          link.classList.add('highlight-link')
        } else {
          link.classList.remove('highlight-link')
        }

      }
      const membership = {};

      d3.csv("EuropeanStates.csv", function(data) {

        for (var i = 0; i < data.length; i++) {
          membership[data[i].State] = data[i]
        }
      });

      const generalColorScheme = {

        'EU': {
          'EU': '#f75413',
          'Candidate': 'red'
        },
        'Currency': {
          '€': '#f75413',
          'DKK': 'orange',
          'SEK': 'orange',
          'GBP': 'orange',
        },
        'Euro-relation': {
          'yes': '#f75413',
          'obligated':'#FBB135',
          'exempt': 'orange'
        },
        'NATO': {
          'NATO': '#f75413'
        },
        'CurrencyUnion': {
          'EUCU': '#f75413'
        },
        'Schengen': {
          'Schengen': '#f75413',
          'visa-free': 'red'
        },
        'EEA': {
          'EEA': '#f75413'
        }

      }


      const colorify = (data, cat) => {

        if(cat === 'blank') {return 'gray'}
        let stateName = data.properties.admin
        if (!membership[stateName]) { return 'gray' }

        let status = membership[stateName][`${cat}`]
        if (!generalColorScheme[`${cat}`][`${status}`]) { return 'gray' }
        return generalColorScheme[`${cat}`][`${status}`]

      }


      const handleTransition = (cate) => {
        let dur = 400;
        if(cate === 'income') {
          handleIncome(dur)
          return
        }
        // makeMapTransparent(dur)
        handleMapColorUpdate(cate)
        // makeMapOpaque(dur)
      }

      // const makeMapTransparent = (duration) => {
      //   d3.selectAll('path')
      //         .transition().duration(`${duration}`)
      //         .style('fill-opacity', 0.1)
      // }
      //
      // const makeMapOpaque = (duration) => {
      //   setTimeout(() => d3.selectAll('path')
      //           .transition().duration(`${duration}`)
      //           .style('fill-opacity', 0.9), `${duration}`)
      // }


      const handleMapColorUpdate = (category) => {

        d3.selectAll('path')
            .attr('fill', (d) => colorify(d, category))
      }

      const adjustIncome = (realIncome) => {

        if (realIncome > 50000) { realIncome = 50000 }
        return realIncome
      }

      const handleIncome = (duration) => {

        const colorbyIncome = d3.scaleLinear().domain([100, 50000]).range(['#FBB135', 'red']);
        // makeMapTransparent(duration)
        d3.selectAll('path')
            .attr('fill', (d) => {
              let stateName = d.properties.admin
              if (!membership[stateName]) { return '#FBB135' }
              let status = membership[stateName]['GNI']
              // console.log(parseInt(status.split(',').join('')));
              let number = parseInt(status.split(',').join(''))
              let adjusted = adjustIncome(number)
              return colorbyIncome(adjusted)

            })

            // makeMapOpaque(duration);
      }

      const handleAccession = (stage) => {
        d3.selectAll('path')
            .attr('fill', (d) => accessionColorScheme(d, stage ))
      }


      const accessionColorScheme = (data, stage) => {

        let stateName = data.properties.admin
        if (!membership[stateName]) { return 'gray' }

        let year = parseInt(membership[stateName]['Year-joined']);

        switch (stage) {
          case 'eu':{
            if (year) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'six': {
            if(year === 1957) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'twelve': {
            if(year === 1957) {
              return '#f75413'
            } else if (year > 1957 && year <= 1992) {
              return '#FBB135'
            } else {
              return 'gray'
            }
          }
          case 'fifteen': {
            if(year <= 1992) {
              return '#f75413';
            } else if (year === 1995) {
              return '#FBB135'
            } else {
              return 'gray'
            }
          }
          case 'eastern': {
            if(year <= 1995) {
              return '#f75413';
            } else if (year === 2004) {
              return '#FBB135'
            } else {
              return 'gray'
            }
          }
          case 'now':{
            if(year <= 2004) {
              return '#f75413';
            } else if (year) {
              return '#FBB135'
            } else {
              return 'gray'
            }
          }
          case 'brexit':{
            if(stateName === 'United Kingdom') {
              return 'orange';
            } else if (year) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'reluctant':{
            if(membership[stateName]['EU'] === 'reluctant') {
              return 'orange';
            } else if (year) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'candidates':{

            if(membership[stateName]['EU'] === 'Candidate') {
              return 'orange';
            } else if (year) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          default:

        }

      }

      const handleEuro = (cate) => {
        d3.selectAll('path')
            .attr('fill', (d) => euroColorScheme(d, cate))
      }

      const euroColorScheme = (data, slide) => {
        let stateName = data.properties.admin
        if (!membership[stateName]) { return 'gray' }

        // let currency = membership[stateName]['Currency'];
        let euroRelation = membership[stateName]['Euro-relation']
        let euStatus = membership[stateName]['EU']
        // if (!year) { return 'gray' }

        switch (slide) {
          case 'eu':{
            if (euStatus === 'EU') {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'eurozone':{
            if (euroRelation === 'yes') {
              return '#f75413'
            } else {
              return 'gray'
            }
          }

          case 'obligated':{
            if (euroRelation === 'yes') {
              return '#f75413'
            } else if (euroRelation === 'obligated') {
              return 'orange'
            } else {
              return 'gray'
            }
          }

          case 'exempt':{
            if (euroRelation === 'yes') {
              return '#f75413'
            } else if (euroRelation === 'obligated') {
              return 'gray'
            } else if (euroRelation === 'exempt') {
              return 'orange'
            } else {
              return 'gray'
            }
          }
        }
      }

      const debtTable = {}

      d3.csv("debt.csv", function(data) {

        for (var i = 0; i < data.length; i++) {
          debtTable[data[i].country] = data[i]
        }
      });


      const handleDebt = (yr, piigs) => {
        d3.selectAll('path')
            .attr('fill', (d) => colorByDebt(d, yr, piigs))
      }

      const debtLevelColorScheme = d3.scaleLinear().domain([0, 200]).range(['yellow', 'red']);
      const debtPercentChangeColorScheme = d3.scaleLinear().domain([0, 160]).range(['yellow', 'red']);

      const colorByDebt = (data, year, piigs) => {
        let stateName = data.properties.admin
        if(!debtTable[stateName]) { return 'gray' }

        if(piigs) {
          return debtPercentChangeColorScheme(debtTable[`${stateName}`]['percent-change'])
        }

        return debtLevelColorScheme(debtTable[`${stateName}`][`${year}`])
      }


      const handleSchengen = (status) => {
        d3.selectAll('path')
            .attr('fill', (d) => schengenColorScheme(d, status))

      }

      const schengenColorScheme = (data, status) => {
        let stateName = data.properties.admin
        if(!membership[stateName]) { return 'gray' }

        let schengenStatus = membership[stateName]['Schengen']
        let isEuMember = membership[stateName]['EU'] === 'EU'
        switch (status) {
          case 'member': {
            if(schengenStatus === 'Schengen') {
              return '#f75413'
            } else {
              return 'gray'
            }
          }

          case 'exempt': {
            if(schengenStatus === 'Schengen') {
              return '#f75413'
            } else if(!schengenStatus && isEuMember) {
              return 'orange'
            } else {
              return 'gray'
            }
          }
          case 'nonEU': {
            if(schengenStatus === 'Schengen' && isEuMember) {
              return '#f75413'
            } else if(schengenStatus === 'Schengen' && !isEuMember) {
              return 'orange'
            } else {
              return 'gray'
            }
          }
          case 'possibleExpansion': {
            if(schengenStatus === 'Schengen') {
              return '#f75413'
            } else if(schengenStatus == 'EU visa-free') {
              return 'orange'
            } else {
              return 'gray'
            }
          }
        }
      }


      const migrationTable = {}

      d3.csv("migration.csv", function(data) {

        for (var i = 0; i < data.length; i++) {
          migrationTable[data[i].country] = data[i]
        }
      });

      const entryColoring = d3.scaleLinear().domain([10000, 250000]).range(['#fd8828', 'red']);
      const asylumTotalColoring = d3.scaleLinear().domain([0, 500000]).range(['#FED130', 'red']);
      const asylumByPopColoring = d3.scaleLinear().domain([0, 150]).range(['#F9A641', 'red']);



      const handleMigration = (category) => {

        d3.selectAll('path')
            .attr('fill', (d) => migrationColorScheme(d, category))
      }

      const migrationColorScheme = (data, category) => {
        let stateName = data.properties.admin
        if(!membership[stateName]) { return 'gray' }
        if(!migrationTable[`${stateName}`]) { return 'gray' }

        let value = parseInt(migrationTable[`${stateName}`][`${category}`])
        switch (category) {
          case 'entry': {
            if (!value) {return '#FDA429'}
            return entryColoring(value)
          }
          case 'asylumTotal': {
            return asylumTotalColoring(value)
          }

          case 'asylumByPop': {
            return asylumByPopColoring(value)
          }
        }
      }

      const natoMembers = {};

      d3.csv("nato.csv", function(data) {

        for (var i = 0; i < data.length; i++) {
          natoMembers[data[i].country] = data[i]
        }

      });


      const handleNato = (category) => {

        d3.selectAll('path')
            .attr('fill', (d) => natoColorScheme(d, category))
      }

      const natoColorScheme = (data, category) => {
        let stateName = data.properties.admin
        if(category === 'ukraine' && stateName === 'Ukraine') { return 'orange' }
        if(!membership[`${stateName}`]) { return 'gray' }
        if(!natoMembers[`${stateName}`]) { return 'gray' }

        let year = parseInt(natoMembers[stateName]['joined']);

        switch (category) {
          case 'members': {
            return '#f75413'
          }
          case 'original': {
            if(year === 1949) {
              return '#f75413'
            } else {
              return 'gray'
            }
          }
          case 'expansion': {
            if(year === 1949) {
              return '#f75413'
            } else if(year > 1949 && year < 1999) {
              return 'orange'
            } else {
              return 'gray'
            }
          }
          case 'eastern': {
            if(year < 1999) {
              return '#f75413'
            } else if(year >= 1999) {
              return 'orange'
            } else {
              return 'gray'
            }
          }
          case 'ukraine': {
            if(year) {
              return '#f75413'
            } else if (stateName === 'Ukraine') {
              return 'orange'
            } else {
              return 'gray'
            }
          }




        }

      }



      const showModal = function(data) {
           var modal = document.getElementById('infoModal');

           modal.style.left = event.pageX +'px';
           modal.style.top = event.pageY + 'px';
           modal.style.height = '50px';
           modal.style.width = '100px';
           modal.style.paddingRight = '.7em';
           modal.style.paddingLeft = '.7em';
           modal.innerHTML = data.properties.admin;
      };

      const hideModal = () => {

        // modal.classList.add('hide-modal')
        var modal = document.getElementById('infoModal');
        modal.style.height = 0;
        modal.style.width = 0;
        modal.style.padding = 0;
        modal.style.border = 'none';
        modal.innerHTML = '';
      }

      //must have window events here not on the country
      window.addEventListener('scroll', () => hideModal())

      d3.json("region_un_Europe_subunits.json", function(error, data) {

         const countries = data.features

         map = svg.append('g').attr('class', 'boundary');

         europe = map.selectAll('path').data(countries) //must always be features regardless of what it says in json

        europe.enter()
          .append('path')
          .attr('d', path)
          .attr('stroke', 'white')
          .attr('stroke-width', 0.6)
          .attr('fill', (d) => 'gray')
          .on('mouseover', (d) => showModal(d))





        europe.exit().remove();
      })

      let runCycle = true

      function cycleHighlight(delay) {
          if (!runCycle) { return }
          var x = 0;
          var intervalID = window.setInterval(function () {

            let nations = ['Germany', 'Ukaine', 'Greece', 'Italy', 'Romania', 'Czech Republic', 'Portugal', 'France', 'Sweden', 'Slovenia', 'Spain', 'Belarus' ]

            d3.selectAll('path')
                .attr('fill', (d) => {
                  if(d.properties.admin == nations[x]) {
                    return 'orange';
                  } else {
                    return 'gray'
                  }
                })

             if (++x === nations.length) {
               runCycle = false;
                 window.clearInterval(intervalID);
                 d3.selectAll('path')
                     .attr('fill', 'gray')
             }
          }, delay);
      }




      const enter1 = new Waypoint({
        element: document.getElementById('trigger-first-section'),
        handler: function() {
          cycleHighlight(120);

        }
        // offset: '40%'
      })
      const reverseEnter1 = new Waypoint({
        element: document.getElementById('reverse-enter-section-1'),
        handler: function() {
          handleMapColorUpdate('blank');
          switchLinkHighlight('welcome-link', true);
          switchLinkHighlight('eu-link', false);
        },
        offset: '50%'
      })

      const enter2 = new Waypoint({
        element: document.getElementById('enter-section-2'),
        handler: function() {
          handleAccession('eu');
          switchLinkHighlight('welcome-link', false);
          switchLinkHighlight('eu-link', true);
        },
        offset: '30%'
      })
      const reverseEnter2 = new Waypoint({
        element: document.getElementById('reverse-enter-section-2'),
        handler: function() {
          handleAccession('eu')
        },
        offset: '50%'
      })

      const enter3 = new Waypoint({
        element: document.getElementById('enter-section-3'),
        handler: function() {
          handleAccession('candidates')
        },
        offset: '30%'
      })

      const reverseEnter3 = new Waypoint({
        element: document.getElementById('reverse-enter-section-3'),
        handler: function() {
          handleAccession('candidates')
        },
        offset: '50%'
      })

      const enter4 = new Waypoint({
        element: document.getElementById('enter-section-4'),
        handler: function() {
          handleAccession('reluctant');
        },
        offset: '30%'
      })
      const reverseEnter4 = new Waypoint({
        element: document.getElementById('reverse-enter-section-4'),
        handler: function() {
          handleAccession('reluctant');
        },
        offset: '50%'
      })


      const enter5 = new Waypoint({
        element: document.getElementById('enter-section-5'),
        handler: function() {
          handleAccession('eu')
        },
        offset: '30%'
      })
      const reverseEnter5 = new Waypoint({
        element: document.getElementById('reverse-enter-section-5'),
        handler: function() {
          handleAccession('eu')
        },
        offset: '50%'
      })

      const enter6 = new Waypoint({
        element: document.getElementById('enter-section-6'),
        handler: function() {
          handleAccession('six')
        },
        offset: '30%'
      })
      const reverseEnter6 = new Waypoint({
        element: document.getElementById('reverse-enter-section-6'),
        handler: function() {
          handleAccession('six')
        },
        offset: '50%'
      })
      const enter7 = new Waypoint({
        element: document.getElementById('enter-section-7'),
        handler: function() {
          handleAccession('twelve')
        },
        offset: '30%'
      })
      const reverseEnter7 = new Waypoint({
        element: document.getElementById('reverse-enter-section-7'),
        handler: function() {
          handleAccession('twelve')
        },
        offset: '50%'
      })
      const enter8 = new Waypoint({
        element: document.getElementById('enter-section-8'),
        handler: function() {
          handleAccession('fifteen')
        },
        offset: '30%'
      })
      const reverseEnter8 = new Waypoint({
        element: document.getElementById('reverse-enter-section-8'),
        handler: function() {
          handleAccession('fifteen')
        },
        offset: '50%'
      })
      const enter9 = new Waypoint({
        element: document.getElementById('enter-section-9'),
        handler: function() {
          handleAccession('eastern')
        },
        offset: '30%'
      })
      const reverseEnter9 = new Waypoint({
        element: document.getElementById('reverse-enter-section-9'),
        handler: function() {
          handleAccession('eastern')
        },
        offset: '50%'
      })
      const enter10 = new Waypoint({
        element: document.getElementById('enter-section-10'),
        handler: function() {
          handleAccession('now')
        },
        offset: '30%'
      })
      const reverseEnter10 = new Waypoint({
        element: document.getElementById('reverse-enter-section-10'),
        handler: function() {
          handleAccession('now')
        },
        offset: '50%'
      })
      const enter11 = new Waypoint({
        element: document.getElementById('enter-section-11'),
        handler: function() {
          handleAccession('brexit')
        },
        offset: '30%'
      })
      const reverseEnter11 = new Waypoint({
        element: document.getElementById('reverse-enter-section-11'),
        handler: function() {
          handleAccession('brexit')
          switchLinkHighlight('eu-link', true);
          switchLinkHighlight('eurozone-link', false);
        },
        offset: '50%'
      })
      const enter12 = new Waypoint({
        element: document.getElementById('enter-section-12'),
        handler: function() {
          handleEuro('eu');
          switchLinkHighlight('eu-link', false);
          switchLinkHighlight('eurozone-link', true);
        },
        offset: '30%'
      })
      const reverseEnter12 = new Waypoint({
        element: document.getElementById('reverse-enter-section-12'),
        handler: function() {
          handleEuro('eu');
        },
        offset: '50%'
      })
      const enter13 = new Waypoint({
        element: document.getElementById('enter-section-13'),
        handler: function() {
          handleEuro('eurozone')
        },
        offset: '30%'
      })
      const reverseEnter13 = new Waypoint({
        element: document.getElementById('reverse-enter-section-13'),
        handler: function() {
          handleEuro('eurozone')
        },
        offset: '50%'
      })
      const enter14 = new Waypoint({
        element: document.getElementById('enter-section-14'),
        handler: function() {
          handleEuro('obligated')
        },
        offset: '30%'
      })
      const reverseEnter14 = new Waypoint({
        element: document.getElementById('reverse-enter-section-14'),
        handler: function() {
          handleEuro('obligated')        },
        offset: '50%'
      })
      const enter15 = new Waypoint({
        element: document.getElementById('enter-section-15'),
        handler: function() {
          handleEuro('exempt');
        },
        offset: '30%'
      })
      const reverseEnter15 = new Waypoint({
        element: document.getElementById('reverse-enter-section-15'),
        handler: function() {
          handleEuro('exempt');
          switchLinkHighlight('eurozone-link', true);
          switchLinkHighlight('eurocrisis-link', false);
        },
        offset: '50%'
      })
      const enter16 = new Waypoint({
        element: document.getElementById('enter-section-16'),
        handler: function() {
          handleEuro('eurozone');
          switchLinkHighlight('eurocrisis-link', true);
          switchLinkHighlight('eurozone-link', false);
        },
        offset: '30%'
      })
      const reverseEnter16 = new Waypoint({
        element: document.getElementById('reverse-enter-section-16'),
        handler: function() {
          handleEuro('eurozone')        },
        offset: '50%'
      })
      const enter17 = new Waypoint({
        element: document.getElementById('enter-section-17'),
        handler: function() {
          handleDebt(2008);
        },
        offset: '30%'
      })
      const reverseEnter17 = new Waypoint({
        element: document.getElementById('reverse-enter-section-17'),
        handler: function() {
          handleDebt(2008);
        },
        offset: '50%'
      })
      const enter18 = new Waypoint({
        element: document.getElementById('enter-section-18'),
        handler: function() {
          handleDebt(2016);
        },
        offset: '30%'
      })
      const reverseEnter18 = new Waypoint({
        element: document.getElementById('reverse-enter-section-18'),
        handler: function() {
          handleDebt(2016);
        },
        offset: '50%'
      })
      const enter19 = new Waypoint({
        element: document.getElementById('enter-section-19'),
        handler: function() {
          handleDebt(2016, true);
        },
        offset: '30%'
      })
      const reverseEnter19 = new Waypoint({
        element: document.getElementById('reverse-enter-section-19'),
        handler: function() {
          handleDebt(2016, true);
          switchLinkHighlight('eurocrisis-link', true)
          switchLinkHighlight('Schengen-link', false);
        },
        offset: '50%'
      })
      const enter20 = new Waypoint({
        element: document.getElementById('enter-section-20'),
        handler: function() {
          handleSchengen('member');
          switchLinkHighlight('Schengen-link', true)
          switchLinkHighlight('eurocrisis-link', false)
        },
        offset: '30%'
      })
      const reverseEnter20 = new Waypoint({
        element: document.getElementById('reverse-enter-section-20'),
        handler: function() {
          handleSchengen('member');
        },
        offset: '50%'
      })
      const enter21 = new Waypoint({
        element: document.getElementById('enter-section-21'),
        handler: function() {
          handleSchengen('exempt');

        },
        offset: '30%'
      })
      const reverseEnter21 = new Waypoint({
        element: document.getElementById('reverse-enter-section-21'),
        handler: function() {
          handleSchengen('exempt');
        },
        offset: '50%'
      })
      const enter22 = new Waypoint({
        element: document.getElementById('enter-section-22'),
        handler: function() {
          handleSchengen('nonEU');
        },
        offset: '30%'
      })
      const reverseEnter22 = new Waypoint({
        element: document.getElementById('reverse-enter-section-22'),
        handler: function() {
          handleSchengen('nonEU')
        },
        offset: '50%'
      })
      const enter23 = new Waypoint({
        element: document.getElementById('enter-section-23'),
        handler: function() {
          handleSchengen('possibleExpansion');
        },
        offset: '30%'
      })
      const reverseEnter23 = new Waypoint({
        element: document.getElementById('reverse-enter-section-23'),
        handler: function() {
          handleSchengen('possibleExpansion');
        },
        offset: '50%'
      })
      const enter24 = new Waypoint({
        element: document.getElementById('enter-section-24'),
        handler: function() {
          handleSchengen('member');

        },
        offset: '30%'
      })
      const reverseEnter24 = new Waypoint({
        element: document.getElementById('reverse-enter-section-24'),
        handler: function() {
          handleSchengen('member');
          switchLinkHighlight('Schengen-link', true)
          switchLinkHighlight('migration-link', false)
        },
        offset: '50%'
      })
      const enter25 = new Waypoint({
        element: document.getElementById('enter-section-25'),
        handler: function() {
          handleMigration('entry');
          switchLinkHighlight('migration-link', true);
          switchLinkHighlight('Schengen-link', false);
        },
        offset: '30%'
      })
      const reverseEnter25 = new Waypoint({
        element: document.getElementById('reverse-enter-section-25'),
        handler: function() {
          handleMigration('entry');
        },
        offset: '50%'
      })
      const enter26 = new Waypoint({
        element: document.getElementById('enter-section-26'),
        handler: function() {
          handleMigration('asylumTotal');
        },
        offset: '30%'
      })
      const reverseEnter26 = new Waypoint({
        element: document.getElementById('reverse-enter-section-26'),
        handler: function() {
          handleMigration('asylumTotal');
        },
        offset: '50%'
      })
      const enter27 = new Waypoint({
        element: document.getElementById('enter-section-27'),
        handler: function() {
          handleMigration('asylumByPop')
        },
        offset: '30%'
      })
      const reverseEnter27 = new Waypoint({
        element: document.getElementById('reverse-enter-section-27'),
        handler: function() {
          handleMigration('asylumByPop');
          switchLinkHighlight('migration-link', true);
          switchLinkHighlight('nato-link', false);

        },
        offset: '50%'
      })
      const enter28 = new Waypoint({
        element: document.getElementById('enter-section-28'),
        handler: function() {
          handleNato('members');
          switchLinkHighlight('nato-link', true);
          switchLinkHighlight('migration-link', false);

        },
        offset: '30%'
      })
      const reverseEnter28 = new Waypoint({
        element: document.getElementById('reverse-enter-section-28'),
        handler: function() {
          handleNato('members');
        },
        offset: '50%'
      })
      const enter29 = new Waypoint({
        element: document.getElementById('enter-section-29'),
        handler: function() {
          handleNato('original')
        },
        offset: '30%'
      })
      const reverseEnter29 = new Waypoint({
        element: document.getElementById('reverse-enter-section-29'),
        handler: function() {
          handleNato('original');
        },
        offset: '50%'
      })
      const enter30 = new Waypoint({
        element: document.getElementById('enter-section-30'),
        handler: function() {
          handleNato('expansion');
        },
        offset: '30%'
      })
      const reverseEnter30 = new Waypoint({
        element: document.getElementById('reverse-enter-section-30'),
        handler: function() {
          handleNato('expansion');
        },
        offset: '50%'
      })
      const enter31 = new Waypoint({
        element: document.getElementById('enter-section-31'),
        handler: function() {
          handleNato('eastern');
        },
        offset: '30%'
      })
      const reverseEnter31 = new Waypoint({
        element: document.getElementById('reverse-enter-section-31'),
        handler: function() {
          handleNato('eastern');
        },
        offset: '50%'
      })
      const enter32 = new Waypoint({
        element: document.getElementById('enter-section-32'),
        handler: function() {
          handleNato('ukraine');
        },
        offset: '30%'
      })
      const reverseEnter32 = new Waypoint({
        element: document.getElementById('reverse-enter-section-32'),
        handler: function() {
          handleNato('ukraine');
          switchLinkHighlight('nato-link', true);
          // switchLinkHighlight('about-link', false);
        },
        offset: '50%'
      })
      // const outro = new Waypoint({
      //   element: document.getElementById('outro'),
      //   handler: function() {
      //     switchLinkHighlight('nato-link', false);
      //     switchLinkHighlight('about-link', true);
      //   },
      //   offset: '50%'
      // })

    </script>
  </body>
</html>
